# Smithery configuration file: https://smithery.ai/docs/config#smitheryyaml

# Use container runtime for HTTP transport
runtime: "container"
build:
  dockerfile: "Dockerfile"
  dockerBuildPath: "."

# Environment variables for the container
env:
  NODE_ENV: "production"
  USE_HTTP: "true"
  PORT: "8080"

startCommand:
  type: "http"
  configSchema:
    type: object
    required:
      - msTenantId
      - msClientId
      - msClientSecret
    properties:
      msTenantId:
        type: string
        title: "Microsoft Tenant ID"
        description: Microsoft Tenant ID for authentication
      msClientId:
        type: string
        title: "Microsoft Client ID"
        description: Microsoft Client ID for authentication
      msClientSecret:
        type: string
        title: "Microsoft Client Secret"
        description: Microsoft Client Secret for authentication
      stateless:
        type: boolean
        description: Use stateless HTTP mode (default false)
        default: false
      logLevel:
        type: string
        enum: ["debug", "info", "warn", "error"]
        description: Log level (default info)
        default: "info"
  exampleConfig:
    msTenantId: "your-tenant-id-here"
    msClientId: "your-client-id-here"
    msClientSecret: "your-client-secret-here"
    stateless: false
    logLevel: "info"

# ============================================
# TOOL DISCOVERY METADATA FOR SMITHERY
# ============================================
tools:
  # ===== CORE M365 MANAGEMENT TOOLS =====
  - name: manage_distribution_lists
    description: Manage Microsoft 365 distribution lists - create, update, delete, and manage membership
    category: Microsoft 365
    tags: [email, groups, distribution-lists, m365]

  - name: manage_security_groups
    description: Manage Azure AD security groups - create, update, delete, and manage membership
    category: Azure AD
    tags: [security, groups, azure-ad, access-control]

  - name: manage_m365_groups
    description: Manage Microsoft 365 Groups - create, update, delete, and manage membership
    category: Microsoft 365
    tags: [groups, collaboration, teams, m365]

  - name: manage_exchange_settings
    description: Manage Exchange Online settings - mailbox configuration, transport rules, and policies
    category: Exchange Online
    tags: [exchange, email, mailbox, transport-rules]

  - name: manage_user_settings
    description: Manage user settings and configurations across Microsoft 365 services
    category: User Management
    tags: [users, settings, configuration, m365]

  - name: manage_offboarding
    description: Automate user offboarding processes - disable accounts, backup data, transfer ownership
    category: User Management
    tags: [offboarding, security, data-transfer, lifecycle]

  # ===== SHAREPOINT TOOLS =====
  - name: manage_sharepoint_sites
    description: Manage SharePoint sites - create, configure, and manage site settings and permissions
    category: SharePoint
    tags: [sharepoint, sites, collaboration, content-management]

  - name: manage_sharepoint_lists
    description: Manage SharePoint lists and libraries - create, configure, and manage list items
    category: SharePoint
    tags: [sharepoint, lists, data-management, content]

  # ===== AZURE AD MANAGEMENT TOOLS =====
  - name: manage_azure_ad_roles
    description: Manage Azure AD directory roles - assign, remove, and list role assignments
    category: Azure AD
    tags: [roles, permissions, rbac, azure-ad]

  - name: manage_azure_ad_apps
    description: Manage Azure AD application registrations - create, update, and manage app permissions
    category: Azure AD
    tags: [applications, app-registrations, azure-ad, oauth]

  - name: manage_azure_ad_devices
    description: Manage Azure AD registered devices - enable, disable, delete, and monitor devices
    category: Azure AD
    tags: [devices, device-management, azure-ad, security]

  - name: manage_service_principals
    description: Manage Azure AD service principals - create, update, and manage service principal permissions
    category: Azure AD
    tags: [service-principals, applications, azure-ad, automation]

  # ===== API ACCESS TOOLS =====
  - name: call_microsoft_api
    description: Dynamic API endpoint for calling any Microsoft Graph or Azure Resource Management API
    category: API Access
    tags: [graph-api, azure-api, dynamic, automation]

  # ===== SECURITY & COMPLIANCE TOOLS =====
  - name: search_audit_log
    description: Search and analyze Azure AD unified audit logs for compliance and security monitoring
    category: Security & Compliance
    tags: [audit-logs, compliance, security, monitoring]

  - name: manage_alerts
    description: Manage and respond to Microsoft security alerts from various security products
    category: Security & Compliance
    tags: [security-alerts, incident-response, monitoring, threat-detection]

  # ===== DLP AND INFORMATION PROTECTION TOOLS =====
  - name: manage_dlp_policies
    description: Manage Data Loss Prevention policies across Microsoft 365 services
    category: Security & Compliance
    tags: [dlp, data-protection, compliance, security]

  - name: manage_dlp_incidents
    description: Manage and investigate DLP policy incidents and violations
    category: Security & Compliance
    tags: [dlp, incidents, investigation, compliance]

  - name: manage_sensitivity_labels
    description: Manage sensitivity labels for information protection and classification
    category: Security & Compliance
    tags: [sensitivity-labels, information-protection, classification, compliance]

  - name: manage_retention_policies
    description: Manage retention policies for email, documents, and other content across Microsoft 365
    category: Security & Compliance
    tags: [retention, compliance, records-management, data-governance]

  - name: manage_conditional_access_policies
    description: Manage Azure AD conditional access policies for secure access control
    category: Security & Compliance
    tags: [conditional-access, security, zero-trust, authentication]

  - name: manage_information_protection_policies
    description: Manage Azure Information Protection policies for data classification and protection
    category: Security & Compliance
    tags: [information-protection, data-security, classification, compliance]

  - name: manage_defender_policies
    description: Manage Microsoft Defender for Office 365 security policies and settings
    category: Security & Compliance
    tags: [defender, security, threat-protection, anti-malware]

  - name: manage_security_alert_policies
    description: Manage security alert policies and notification rules across Microsoft 365
    category: Security & Compliance
    tags: [security-alerts, notifications, monitoring, incident-response]

  # ===== INTUNE MACOS MANAGEMENT TOOLS =====
  - name: manage_intune_macos_devices
    description: Manage macOS devices in Microsoft Intune - enrollment, compliance, and device actions
    category: Device Management
    tags: [intune, macos, device-management, mdm]

  - name: manage_intune_macos_policies
    description: Manage macOS configuration and compliance policies in Intune
    category: Device Management
    tags: [intune, macos, policies, configuration, compliance]

  - name: manage_intune_macos_apps
    description: Manage macOS application deployment and management through Intune
    category: Device Management
    tags: [intune, macos, applications, app-deployment]

  - name: manage_intune_macos_compliance
    description: Assess and report on macOS device compliance with organizational policies
    category: Device Management
    tags: [intune, macos, compliance, assessment, reporting]

  # ===== INTUNE WINDOWS MANAGEMENT TOOLS =====
  - name: manage_intune_windows_devices
    description: Manage Windows devices in Microsoft Intune - enrollment, autopilot, and device actions
    category: Device Management
    tags: [intune, windows, device-management, mdm, autopilot]

  - name: manage_intune_windows_policies
    description: Manage Windows configuration profiles and security baselines in Intune
    category: Device Management
    tags: [intune, windows, policies, configuration, security-baselines]

  - name: manage_intune_windows_apps
    description: Manage Windows application deployment - Win32, Store, Office 365 apps through Intune
    category: Device Management
    tags: [intune, windows, applications, app-deployment, win32]

  - name: manage_intune_windows_compliance
    description: Assess Windows device compliance including BitLocker, antivirus, and security configurations
    category: Device Management
    tags: [intune, windows, compliance, bitlocker, security]

  # ===== COMPLIANCE FRAMEWORK TOOLS =====
  - name: manage_compliance_frameworks
    description: Manage compliance frameworks (HITRUST, ISO27001, SOC2, CIS) and their configurations
    category: Security & Compliance
    tags: [compliance, frameworks, governance, risk-management]

  - name: manage_compliance_assessments
    description: Execute compliance assessments against various frameworks and standards
    category: Security & Compliance
    tags: [compliance, assessment, auditing, frameworks]

  - name: manage_compliance_monitoring
    description: Monitor ongoing compliance status and receive alerts for compliance drift
    category: Security & Compliance
    tags: [compliance, monitoring, alerts, status]

  - name: manage_evidence_collection
    description: Automated evidence collection for compliance and audit purposes
    category: Security & Compliance
    tags: [evidence, compliance, auditing, documentation]

  - name: manage_gap_analysis
    description: Perform gap analysis against compliance frameworks and standards
    category: Security & Compliance
    tags: [gap-analysis, compliance, assessment, frameworks]

  - name: generate_audit_reports
    description: Generate comprehensive audit reports for compliance and security assessments
    category: Security & Compliance
    tags: [audit-reports, compliance, documentation, reporting]

  - name: manage_cis_compliance
    description: Assess CIS (Center for Internet Security) benchmark compliance across systems
    category: Security & Compliance
    tags: [cis, benchmarks, security, compliance, assessment]

  # ===== POLICY MANAGEMENT TOOLS =====
  - name: manage_teams_policies
    description: Manage Microsoft Teams policies including messaging, meeting, and calling policies
    category: Microsoft Teams
    tags: [teams, policies, governance, collaboration, configuration]

  - name: manage_exchange_policies
    description: Manage Exchange Online policies including mail flow, retention, and mobile device policies
    category: Exchange Online
    tags: [exchange, email, policies, mail-flow, governance]

  - name: manage_sharepoint_governance_policies
    description: Manage SharePoint governance policies including sharing, access, and site policies
    category: SharePoint
    tags: [sharepoint, governance, policies, sharing, access-control]

  # ===== ADVANCED GRAPH API TOOLS =====
  - name: execute_graph_batch
    description: Execute multiple Graph API requests in a single batch operation for improved performance
    category: Advanced API
    tags: [graph-api, batch, performance, automation]

  - name: execute_delta_query
    description: Efficiently track changes to Graph resources using delta queries
    category: Advanced API
    tags: [graph-api, delta-query, change-tracking, synchronization]

  - name: manage_graph_subscriptions
    description: Manage Graph API webhook subscriptions for real-time change notifications
    category: Advanced API
    tags: [graph-api, webhooks, subscriptions, real-time, notifications]

  - name: execute_graph_search
    description: Execute advanced search queries across Microsoft 365 content using Graph Search API
    category: Advanced API
    tags: [graph-api, search, content-discovery, advanced-queries]

  # ===== DOCUMENT GENERATION TOOLS =====
  - name: generate_powerpoint_presentation
    description: Create PowerPoint presentations with custom slides, charts, and templates from M365 data
    category: Document Generation
    tags: [powerpoint, presentations, documents, office, reporting]

  - name: generate_word_document
    description: Create Word documents with sections, tables, and professional formatting
    category: Document Generation
    tags: [word, documents, reports, office, documentation]

  - name: generate_html_report
    description: Create interactive HTML reports and dashboards with themes, charts, and responsive design
    category: Document Generation
    tags: [html, reports, dashboards, visualization, web]

  - name: generate_professional_report
    description: Generate comprehensive multi-format reports from Microsoft 365 data (PowerPoint, Word, HTML, PDF)
    category: Document Generation
    tags: [reports, analytics, multi-format, automation, business-intelligence]

  - name: oauth_authorize
    description: Manage OAuth 2.0 authorization for user-delegated file access to OneDrive and SharePoint
    category: Authentication
    tags: [oauth, authentication, authorization, security, file-access]

# ============================================
# RESOURCE DISCOVERY METADATA
# ============================================
resources:
  # ===== SECURITY RESOURCES =====
  - name: security_alerts
    description: Current security alerts from Microsoft Defender and security products
    uri: m365://security/alerts

  - name: security_incidents
    description: Active security incidents requiring attention
    uri: m365://security/incidents

  - name: conditional_access_policies
    description: Conditional access policies and their configuration
    uri: m365://security/conditional-access

  - name: identity_protection
    description: Identity protection risk detections and risky users
    uri: m365://security/identity-protection

  - name: threat_assessment
    description: Threat assessment summary and Microsoft Secure Score
    uri: m365://security/threat-assessment

  # ===== COMPLIANCE RESOURCES =====
  - name: compliance_policies
    description: DLP policies, retention policies, and compliance configurations
    uri: m365://compliance/policies

  - name: audit_summary
    description: Recent audit log activity summary
    uri: m365://compliance/audit-summary

  - name: sensitivity_labels
    description: Information protection sensitivity labels and policies
    uri: m365://compliance/sensitivity-labels

  # ===== DEVICE MANAGEMENT RESOURCES =====
  - name: devices_overview
    description: Overview of all managed devices across platforms
    uri: m365://devices/overview

  - name: device_compliance
    description: Compliance status of managed devices
    uri: m365://devices/compliance

  - name: intune_policies
    description: Device configuration and compliance policies
    uri: m365://devices/intune-policies

  - name: managed_apps
    description: Applications managed through Intune
    uri: m365://devices/apps

  # ===== USER & IDENTITY RESOURCES =====
  - name: user_directory
    description: All users in the organization with key attributes
    uri: m365://users/directory

  - name: user_licenses
    description: License assignments across users
    uri: m365://users/licenses

  - name: privileged_users
    description: Users with administrative roles
    uri: m365://users/privileged

  # ===== GROUP RESOURCES =====
  - name: all_groups
    description: All groups in the organization
    uri: m365://groups/all

  - name: teams_groups
    description: Groups with Teams enabled
    uri: m365://groups/teams

  # ===== SHAREPOINT RESOURCES =====
  - name: sharepoint_sites
    description: List of SharePoint sites in the organization
    uri: m365://sharepoint/sites

  - name: sharepoint_permissions
    description: External sharing permissions across sites
    uri: m365://sharepoint/permissions

  # ===== EXCHANGE RESOURCES =====
  - name: exchange_mailboxes
    description: User mailboxes in Exchange Online
    uri: m365://exchange/mailboxes

  - name: transport_rules
    description: Mail flow transport rules
    uri: m365://exchange/transport-rules

  # ===== COLLABORATION RESOURCES =====
  - name: teams_activity
    description: Microsoft Teams activity reports
    uri: m365://collaboration/teams-activity

  - name: onedrive_usage
    description: OneDrive usage reports
    uri: m365://collaboration/onedrive-usage

  # ===== APPLICATION RESOURCES =====
  - name: app_registrations
    description: Azure AD application registrations
    uri: m365://applications/registrations

  - name: service_principals
    description: Enterprise application service principals
    uri: m365://applications/service-principals

  - name: app_consent
    description: Application consent grants
    uri: m365://applications/consent

  # ===== GOVERNANCE RESOURCES =====
  - name: access_reviews
    description: Access review definitions
    uri: m365://governance/access-reviews

  - name: entitlement_management
    description: Entitlement management catalogs
    uri: m365://governance/entitlement

  # ===== TENANT RESOURCES =====
  - name: organization_info
    description: Organization details and tenant info
    uri: m365://tenant/organization

  - name: tenant_domains
    description: Registered domains
    uri: m365://tenant/domains

  - name: tenant_subscriptions
    description: License subscriptions
    uri: m365://tenant/subscriptions

  # ===== DOCUMENT RESOURCES =====
  - name: presentations
    description: PowerPoint presentations in OneDrive
    uri: m365://documents/presentations

  - name: word_documents
    description: Word documents in OneDrive
    uri: m365://documents/word-documents

  - name: generated_reports
    description: Generated reports and analysis documents
    uri: m365://documents/reports

  - name: document_templates
    description: Available document templates for report generation
    uri: m365://documents/templates

  # ===== POLICY RESOURCES =====
  - name: policies_conditional_access
    description: All conditional access policies and their current state
    uri: m365://policies/conditional-access

  - name: policies_retention
    description: Retention policies across Microsoft 365 workloads
    uri: m365://policies/retention

  - name: policies_information_protection
    description: Azure Information Protection and sensitivity label policies
    uri: m365://policies/information-protection

  - name: policies_defender
    description: Microsoft Defender for Office 365 security policies
    uri: m365://policies/defender

  - name: policies_teams
    description: Microsoft Teams messaging, meeting, and calling policies
    uri: m365://policies/teams

  - name: policies_exchange
    description: Exchange Online mail flow, retention, and mobile device policies
    uri: m365://policies/exchange

  - name: policies_sharepoint_governance
    description: SharePoint sharing, access control, and lifecycle policies
    uri: m365://policies/sharepoint-governance

  - name: policies_security_alerts
    description: Security alert policies and notification configurations
    uri: m365://policies/security-alerts

  - name: policies_overview
    description: Summary of all policies across Microsoft 365
    uri: m365://policies/overview

# ============================================
# PROMPT TEMPLATES FOR COMMON TASKS
# ============================================
prompts:
  # ===== SECURITY PROMPTS =====
  - name: security_assessment
    description: Comprehensive security posture analysis with recommendations for Microsoft 365 environment
    arguments:
      - name: focus_area
        description: "Specific area to focus on: identity, devices, data, compliance, or all (default: all)"
        required: false
      - name: severity_threshold
        description: "Minimum severity to include: low, medium, high, critical (default: medium)"
        required: false

  # ===== COMPLIANCE PROMPTS =====
  - name: compliance_review
    description: Framework-specific compliance gap analysis for SOC2, ISO27001, NIST, GDPR, HIPAA, or CIS
    arguments:
      - name: framework
        description: "Compliance framework: soc2, iso27001, nist, gdpr, hipaa, cis (required)"
        required: true
      - name: scope
        description: Specific controls or domains to focus on (optional)
        required: false

  # ===== USER ACCESS PROMPTS =====
  - name: user_access_review
    description: Individual or organization-wide access rights analysis and recommendations
    arguments:
      - name: user_id
        description: "Specific user to review (UPN or Object ID), or 'all' for org-wide review"
        required: false
      - name: focus
        description: "Focus area: roles, groups, applications, external, or all (default: all)"
        required: false

  # ===== DEVICE MANAGEMENT PROMPTS =====
  - name: device_compliance_analysis
    description: Intune device management and compliance assessment with remediation guidance
    arguments:
      - name: platform
        description: "Platform to analyze: windows, macos, ios, android, or all (default: all)"
        required: false
      - name: compliance_state
        description: "Filter by state: compliant, non-compliant, in-grace-period, or all (default: all)"
        required: false

  # ===== COLLABORATION PROMPTS =====
  - name: collaboration_governance
    description: Microsoft Teams and SharePoint governance analysis with policy recommendations
    arguments:
      - name: focus
        description: "Focus area: teams, sharepoint, external-access, lifecycle, or all (default: all)"
        required: false

  # ===== DOCUMENT GENERATION PROMPTS =====
  - name: generate_client_report
    description: Generate a comprehensive professional report for clients based on Microsoft 365 data analysis
    arguments:
      - name: report_type
        description: "Type of report: security, compliance, audit, governance, or custom (default: custom)"
        required: false
      - name: format
        description: "Output format: powerpoint, word, html, or all (default: all)"
        required: false
      - name: client_name
        description: Client/organization name for the report
        required: false

  # ===== POLICY MANAGEMENT PROMPTS =====
  - name: policy_management_guide
    description: Comprehensive guide for managing Microsoft 365 policies across security, compliance, and governance
    arguments:
      - name: policy_area
        description: "Policy area: security, compliance, teams, exchange, sharepoint, or all (default: all)"
        required: false
      - name: action
        description: "Action to perform: review, create, update, delete, or audit (default: review)"
        required: false

  # ===== INTUNE POLICY PROMPTS =====
  - name: intune_policy_wizard
    description: Interactive wizard for creating Intune policies with best practice configurations
    arguments:
      - name: policy_goal
        description: "What you want to achieve (e.g., encrypt devices, enforce passwords, deploy apps)"
        required: true
      - name: platform
        description: "Target platform: windows, macos, ios, android"
        required: true
      - name: security_level
        description: "Security level: basic, standard, high (default: standard)"
        required: false

  - name: intune_policy_troubleshoot
    description: Troubleshoot Intune policy deployment issues with step-by-step diagnostics
    arguments:
      - name: issue_description
        description: Description of the policy issue or error
        required: true
      - name: policy_type
        description: "Type of policy: compliance, configuration, app, update"
        required: false

